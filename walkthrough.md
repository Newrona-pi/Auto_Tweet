# Auto_Tweet 実装システム解説（ウォークスルー）

本ドキュメントでは、Auto_Tweetシステムの主要な構成要素と動作プロセスを日本語で詳しく解説します。

## 1. データベース構造とシードデータ

システムはNeon Postgresをデータベースとして利用し、Prisma ORMを通じて操作します。

- **`prisma/schema.prisma`**: データベースの設計図です。`Source` (情報源)、`Item` (記事)、`Topic` (話題)、`Summary` (要約)、`DraftPost` (下書き) の各テーブルを定義しています。
- **`prisma/seed.ts`**: 初期セットアップ時に実行されるファイルです。16の厳選されたRSSフィード（OpenAI, NVIDIAなど）を自動的に登録します。

## 2. バックエンド・サービス

各機能は `lib/services/` 内に独立したモジュールとして実装されています。

- **`rss-collector.ts` (収集)**: 
  登録されたソースから最新記事を取得します。記事のURLをユニークキーとして重複排除を行い、**全文ではなくメタデータ（タイトルと抜粋）のみ**を保存することで、ストレージと著作権に配慮しています。
- **`clustering.ts` (整理)**: 
  収集された記事をキーワードに基づきグループ化します。記事の鮮度（投稿時間）とグループの大きさ（記事数）から「注目度（Attention Score）」を計算します。
- **`llm-summarizer.ts` (AI処理)**: 
  OpenAI GPT-4を利用し、上位トピックに対して日本語の要約と注目ポイントの解説を生成します。その後、**80〜140文字以内**の制約でツイートドラフトを作成します。

## 3. 管理画面とAPI

ユーザーがブラウザ上でシステムを操作するためのインターフェースです。

- **`/admin` ページ**: 
  現在の状況確認と、「ニュース収集」「要約生成」の各ステップを手動でトリガーできます。モダンなダークテーマとグラスモーフィズムデザインを採用しています。
- **`/api/admin/` エンドポイント**: 
  フロントエンドからのリクエストを受け、バックエンドサービスを呼び出します。将来の自動化（Cron Jobなど）にも対応可能な構造です。

## 4. 特徴的なこだわりポイント

- **日本語最適化**: 生成される要約やツイート案は、日本の技術コミュニティに適した表現になるようプロンプト（AIへの指示）を調整しています。
- **セキュリティとプライバシー**: 
  - 管理画面には `X-Robots-Tag: noindex` を付与し、Google検索に載らないように配慮。
  - `ENABLE_ADMIN_AUTH` フラグにより、環境変数一つで認証を有効化できる設計。
- **Vercel + Neon 構成**: 
  サーバーレス環境に最適化されており、低コスト（無料枠内）かつ高パフォーマンスで動作します。

## 動作確認のチェックリスト

1. `npm run dev` で起動後、 http://localhost:3000/admin にアクセス。
2. 「Collect Now」で最新記事を取得。
3. 「Summarize Now」で要約とツイートの下書きが生成されることを確認。
4. データベースの中身（Prisma Studio `npx prisma studio` など）で結果を確認。

今後の機能拡張として、環境変数にTwitter APIキーを設定するだけで、生成されたドラフトをそのまま投稿できる自動化機能の追加が容易な作りになっています。
